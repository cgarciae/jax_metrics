
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cgarciae.github.io/jax_metrics/">
      
      <link rel="icon" href="images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.1">
    
    
      
        <title>JAX Metrics</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.e8d9bf0c.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#jax-metrics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="JAX Metrics" class="md-header__button md-logo" aria-label="JAX Metrics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M494.9 96.01c-38.78 0-75.22 15.09-102.6 42.5L320 210.8l-72.2-72.3C220.39 111.09 183.96 96 145.2 96 65.11 96.01 0 161.1 0 241.1v29.75c0 80.03 65.11 145.1 145.1 145.1 38.78 0 75.22-15.09 102.6-42.5L320 301.3l72.23 72.25c27.41 27.41 63.84 42.5 102.6 42.5C574.9 416 640 350.9 640 270.9v-29.75c0-80.05-65.1-145.14-145.1-145.14zM202.5 328.3c-15.31 15.31-35.69 23.75-57.38 23.75C100.4 352 64 315.6 64 270.9v-29.75c0-44.72 36.41-81.13 81.14-81.13 21.69 0 42.06 8.438 57.38 23.75l72.23 72.25-72.25 72.28zM576 270.9c0 44.72-36.41 81.13-81.14 81.13-21.69 0-42.06-8.438-57.38-23.75l-72.23-72.25 72.23-72.25c15.31-15.31 35.69-23.75 57.38-23.75C539.6 160 576 196.4 576 241.1v29.8z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            JAX Metrics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              JAX Metrics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cgarciae/jax_metrics/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  </div>
  <div class="md-source__repository">
    cgarciae/jax_metrics
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="JAX Metrics" class="md-nav__button md-logo" aria-label="JAX Metrics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M494.9 96.01c-38.78 0-75.22 15.09-102.6 42.5L320 210.8l-72.2-72.3C220.39 111.09 183.96 96 145.2 96 65.11 96.01 0 161.1 0 241.1v29.75c0 80.03 65.11 145.1 145.1 145.1 38.78 0 75.22-15.09 102.6-42.5L320 301.3l72.23 72.25c27.41 27.41 63.84 42.5 102.6 42.5C574.9 416 640 350.9 640 270.9v-29.75c0-80.05-65.1-145.14-145.1-145.14zM202.5 328.3c-15.31 15.31-35.69 23.75-57.38 23.75C100.4 352 64 315.6 64 270.9v-29.75c0-44.72 36.41-81.13 81.14-81.13 21.69 0 42.06 8.438 57.38 23.75l72.23 72.25-72.25 72.28zM576 270.9c0 44.72-36.41 81.13-81.14 81.13-21.69 0-42.06-8.438-57.38-23.75l-72.23-72.25 72.23-72.25c15.31-15.31 35.69-23.75 57.38-23.75C539.6 160 576 196.4 576 241.1v29.8z"/></svg>

    </a>
    JAX Metrics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cgarciae/jax_metrics/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
  </div>
  <div class="md-source__repository">
    cgarciae/jax_metrics
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          JAX Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        JAX Metrics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    Main Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-included" class="md-nav__link">
    What is included?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metric" class="md-nav__link">
    Metric
  </a>
  
    <nav class="md-nav" aria-label="Metric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipical-training-setup" class="md-nav__link">
    Tipical Training Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distributed-training" class="md-nav__link">
    Distributed Training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loss" class="md-nav__link">
    Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combinators" class="md-nav__link">
    Combinators
  </a>
  
    <nav class="md-nav" aria-label="Combinators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#losses" class="md-nav__link">
    Losses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lossesandmetrics" class="md-nav__link">
    LossesAndMetrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/Loss/" class="md-nav__link">
        Loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/Losses/" class="md-nav__link">
        Losses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/LossesAndMetrics/" class="md-nav__link">
        LossesAndMetrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/Metric/" class="md-nav__link">
        Metric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/Metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/Named/" class="md-nav__link">
        Named
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" type="checkbox" id="__nav_2_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          losses
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="losses" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          losses
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/CosineSimilarity/" class="md-nav__link">
        CosineSimilarity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/Crossentropy/" class="md-nav__link">
        Crossentropy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/Huber/" class="md-nav__link">
        Huber
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/Loss/" class="md-nav__link">
        Loss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/MeanAbsoluteError/" class="md-nav__link">
        MeanAbsoluteError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/MeanAbsolutePercentageError/" class="md-nav__link">
        MeanAbsolutePercentageError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/MeanSquaredError/" class="md-nav__link">
        MeanSquaredError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/MeanSquaredLogarithmicError/" class="md-nav__link">
        MeanSquaredLogarithmicError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/Reduction/" class="md-nav__link">
        Reduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/cosine_similarity/" class="md-nav__link">
        cosine_similarity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/crossentropy/" class="md-nav__link">
        crossentropy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/huber/" class="md-nav__link">
        huber
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/mean_absolute_error/" class="md-nav__link">
        mean_absolute_error
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/mean_absolute_percentage_error/" class="md-nav__link">
        mean_absolute_percentage_error
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/mean_squared_error/" class="md-nav__link">
        mean_squared_error
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/losses/mean_squared_logarithmic_error/" class="md-nav__link">
        mean_squared_logarithmic_error
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_8">
          metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="metrics" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          metrics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Accuracy/" class="md-nav__link">
        Accuracy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/AuxLosses/" class="md-nav__link">
        AuxLosses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/AuxMetrics/" class="md-nav__link">
        AuxMetrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Losses/" class="md-nav__link">
        Losses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/LossesAndMetrics/" class="md-nav__link">
        LossesAndMetrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/MAE/" class="md-nav__link">
        MAE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/MSE/" class="md-nav__link">
        MSE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Mean/" class="md-nav__link">
        Mean
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/MeanAbsoluteError/" class="md-nav__link">
        MeanAbsoluteError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/MeanSquareError/" class="md-nav__link">
        MeanSquareError
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Metric/" class="md-nav__link">
        Metric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Reduce/" class="md-nav__link">
        Reduce
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/metrics/Reduction/" class="md-nav__link">
        Reduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" type="checkbox" id="__nav_2_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9">
          regularizers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="regularizers" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          regularizers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/regularizers/L1/" class="md-nav__link">
        L1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/regularizers/L1L2/" class="md-nav__link">
        L1L2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="api/regularizers/L2/" class="md-nav__link">
        L2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#main-features" class="md-nav__link">
    Main Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-is-included" class="md-nav__link">
    What is included?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    Getting Started
  </a>
  
    <nav class="md-nav" aria-label="Getting Started">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metric" class="md-nav__link">
    Metric
  </a>
  
    <nav class="md-nav" aria-label="Metric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tipical-training-setup" class="md-nav__link">
    Tipical Training Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distributed-training" class="md-nav__link">
    Distributed Training
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loss" class="md-nav__link">
    Loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combinators" class="md-nav__link">
    Combinators
  </a>
  
    <nav class="md-nav" aria-label="Combinators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#losses" class="md-nav__link">
    Losses
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lossesandmetrics" class="md-nav__link">
    LossesAndMetrics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/cgarciae/jax_metrics/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="jax-metrics">JAX Metrics</h1>
<p><em>A Metrics library for the JAX ecosystem</em></p>
<h4 id="main-features">Main Features</h4>
<ul>
<li>Standard metrics that can be used in any JAX project.</li>
<li>Pytree abstractions that can natively integrate with all JAX APIs and pytree-supporting frameworks (flax.struct, equinox, treex, etc).</li>
<li>Distributed-friendly APIs that make it super easy to synchronize metrics across devices.</li>
<li>Automatic accumulation over epochs.</li>
</ul>
<p>JAX Metrics is implemented on top of <a href="https://github.com/cgarciae/treeo">Treeo</a>.</p>
<h2 id="what-is-included">What is included?</h2>
<ul>
<li>The Keras-like <code>Loss</code> and <code>Metric</code> abstractions.</li>
<li>A <code>metrics</code> module containing popular metrics.</li>
<li>The <code>losses</code> and <code>regularizers</code> modules containing popular losses.</li>
<li>The <code>Metrics</code>, <code>Losses</code>, and <code>LossesAndMetrics</code> combinators.</li>
</ul>
<!-- ## Why JAX Metrics? -->

<h2 id="installation">Installation</h2>
<p>Install using pip:
<div class="highlight"><pre><span></span><code>pip install jax_metrics
</code></pre></div></p>
<h2 id="status">Status</h2>
<p>Metrics on this library are usually tested against their Keras or Torchmetrics counterparts for numerical equivalence. This code base comes from Treex and Elegy so it's already in use.</p>
<h2 id="getting-started">Getting Started</h2>
<h3 id="metric">Metric</h3>
<p>The <code>Metric</code> API consists of 3 basic methods:</p>
<ul>
<li><code>reset</code>: Used to both initialize and reset a metric.</li>
<li><code>update</code>: Takes in new data and updates the metric state.</li>
<li><code>compute</code>: Returns the current value of the metric.</li>
</ul>
<p>Simple usage looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax_metrics</span> <span class="k">as</span> <span class="nn">jm</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">()</span>

<span class="c1"># Initialize the metric</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="c1"># Update the metric with a batch of predictions and labels</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>

<span class="c1"># Get the current value of the metric</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># 0.95</span>

<span class="c1"># alternatively, produce a logs dict</span>
<span class="n">logs</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;accuracy&#39;: 0.95}</span>

<span class="c1"># Reset the metric</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>Note that <code>update</code> enforces the use of keyword arguments. Also the <code>Metric.name</code> property is used as the key in the returned dict, by default this is the name of the class in lowercase but can be overridden in the constructor via the <code>name</code> argument.</p>
<h4 id="tipical-training-setup">Tipical Training Setup</h4>
<p>Because Metrics are pytrees they can be used with <code>jit</code>, <code>pmap</code>, etc. On a more realistic scenario you will proably want to use them inside some of your JAX functions in a setup similar to this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax_metrics</span> <span class="k">as</span> <span class="nn">jm</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">()</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">init_step</span><span class="p">(</span><span class="n">metric</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metric</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metric</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">metric</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>
    <span class="o">...</span>

    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">metric</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">train_step</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">grads</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">,</span> <span class="n">has_aux</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
    <span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">metric</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span> <span class="nf">reset_step</span><span class="p">(</span><span class="n">metric</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metric</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metric</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>Since the loss function usually has access to the predictions and labels, its usually where you would call <code>metric.update</code>, and the new metric state can be returned as an auxiliary output.</p>
<h4 id="distributed-training">Distributed Training</h4>
<p>JAX Metrics has a distributed friendly API via the <code>batch_updates</code> and <code>aggregate</code> methods. A simple example of a loss function inside a data parallel setup could look like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="c1"># compuate batch update</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">batch_updates</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>
    <span class="c1"># gather over all devices and aggregate</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">all_gather</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">()</span>
    <span class="c1"># update metric</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">)</span>
    <span class="o">...</span>
</code></pre></div>
<p>The <code>batch_updates</code> method behaves similar to <code>update</code> but returns a new metric state with only information about that batch, <code>jax.lax.all_gather</code> "gathers" the metric state over all devices plus adds a new axis to the metric state, and <code>aggregate</code> reduces the metric state over all devices (first axis). Finally, <code>merge</code> combines the accumulated metric state over the previous batches with the batch updates.</p>
<h3 id="loss">Loss</h3>
<p>The <code>Loss</code> API just consists of a <code>__call__</code> method. Simple usage looks like this:</p>
<p><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">jax_metrics</span> <span class="k">as</span> <span class="nn">jm</span>

<span class="n">crossentropy</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">Crossentropy</span><span class="p">()</span>

<span class="c1"># get reduced loss value</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">crossentropy</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span> <span class="c1"># 0.23</span>
</code></pre></div>
Note that losses are not pytrees so they should be marked as static. Similar to Keras, all losses have a <code>reduction</code> strategy that can be specified in the constructor and (usually) makes sure that the output is a scalar.</p>
<details>
<summary><b>Why have losses in a metrics library?</b></summary>
<!-- #### Why have losses in a metrics library? -->

There are a few reasons for having losses in a metrics library:

1. Most code from this library was originally written for and will still be consumed by Elegy. Since Elegy needs support for calculating cumulative losses, as you will see later, a Metric abstraction called `Losses` was created for this.
2. A couple of API design decisions are shared between the `Loss` and `Metric` APIs. This includes: 
    * `__call__` and `update` both accept any number keyword only arguments. This is used to facilitate composition (see [Combinators](#combinators) section).
    * Both classes have the `index_into` and `map_arg` methods that allow them to modify how arguments are consumed.
    * Argument names are standardized to be consistent when ever possible, e.g. both `metrics.Accuracy` and `losses.Crossentropy` use the `target` and `preds` arguments. This is super convenient for the `LossesAndMetrics` combinator.

</details>

<h3 id="combinators">Combinators</h3>
<p>Combinators as instances of <code>Metric</code> that enable you to group together multiple instances while maintaining the same API.</p>
<h4 id="metrics">Metrics</h4>
<p>The <code>Metrics</code> combinator lets you combine multiple metrics into a single metric.</p>
<div class="highlight"><pre><span></span><code><span class="n">metrics</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metrics</span><span class="p">([</span>
    <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(),</span>
    <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">F1</span><span class="p">(),</span> <span class="c1"># not yet implemented ðŸ˜…, coming soon?</span>
<span class="p">])</span>

<span class="c1"># same API</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># same API</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>
<span class="c1"># compute now returns a dict</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># {&#39;accuracy&#39;: 0.95, &#39;f1&#39;: 0.87}</span>
<span class="c1"># same as compute_logs in the case</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;accuracy&#39;: 0.95, &#39;f1&#39;: 0.87}</span>
<span class="c1"># Reset the metrics</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>As you can see the <code>Metrics.update</code> method accepts and forwards all the arguments required by the individual metrics. In this example they use the same arguments, but in practice they may consume different subsets of the arguments. Also, if names are repeated then unique names are generated for each metric by appending a number to the metric name.</p>
<p>If a dictionary is used instead of a list, the keys are used instead of the <code>name</code> property of the metrics to determine the key in the returned dict.</p>
<div class="highlight"><pre><span></span><code><span class="n">metrics</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">Metrics</span><span class="p">({</span>
    <span class="s2">&quot;acc&quot;</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(),</span>
    <span class="s2">&quot;f_one&quot;</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">F1</span><span class="p">(),</span> <span class="c1"># not yet implemented ðŸ˜…, coming soon?</span>
<span class="p">})</span>

<span class="c1"># same API</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># same API</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>
<span class="c1"># compute new returns a dict</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># {&#39;acc&#39;: 0.95, &#39;f_one&#39;: 0.87}</span>
<span class="c1"># same as compute_logs in the case</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;acc&#39;: 0.95, &#39;f_one&#39;: 0.87}</span>
<span class="c1"># Reset the metrics</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>You can use nested structures of dicts and lists to group metrics, the keys of the dicts are used to determine group names. Group names and metrics names are concatenated using <code>"/"</code> e.g. <code>"{group_name}/{metric_name}"</code>.</p>
<h4 id="losses">Losses</h4>
<p><code>Losses</code> is a <code>Metric</code> combinator that behaves very similarly to <code>Metrics</code> but contains <code>Loss</code> instances. <code>Losses</code> calculates the cumulative <strong>mean</strong> value of each loss over the batches.</p>
<div class="highlight"><pre><span></span><code><span class="n">losses</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">Losses</span><span class="p">([</span>
    <span class="n">jm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">Crossentropy</span><span class="p">(),</span>
    <span class="n">jm</span><span class="o">.</span><span class="n">regularizers</span><span class="o">.</span><span class="n">L2</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span>
<span class="p">])</span>

<span class="c1"># same API</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># same API</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># compute new returns a dict</span>
<span class="n">losses</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># {&#39;crossentropy&#39;: 0.23, &#39;l2&#39;: 0.005}</span>
<span class="c1"># same as compute_logs in the case</span>
<span class="n">losses</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;crossentropy&#39;: 0.23, &#39;l2&#39;: 0.005}</span>
<span class="c1"># you can also compute the total loss</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span> <span class="c1"># 0.235</span>
<span class="c1"># Reset the losses</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>As with <code>Metrics</code>, the <code>update</code> method accepts and forwards all the arguments required by the individual losses. In this example <code>target</code> and <code>preds</code> are used by the <code>Crossentropy</code>, while <code>parameters</code> is used by the <code>L2</code>. The <code>total_loss</code> method returns the sum of all values returned by <code>compute</code>.</p>
<p>If a dictionary is used instead of a list, the keys are used instead of the <code>name</code> property of the losses to determine the key in the returned dict.</p>
<div class="highlight"><pre><span></span><code><span class="n">losses</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">Losses</span><span class="p">({</span>
    <span class="s2">&quot;xent&quot;</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">Crossentropy</span><span class="p">(),</span>
    <span class="s2">&quot;l_two&quot;</span><span class="p">:</span> <span class="n">jm</span><span class="o">.</span><span class="n">regularizers</span><span class="o">.</span><span class="n">L2</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span>
<span class="p">})</span>

<span class="c1"># same API</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># same API</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># compute new returns a dict</span>
<span class="n">losses</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># {&#39;xent&#39;: 0.23, &#39;l_two&#39;: 0.005}</span>
<span class="c1"># same as compute_logs in the case</span>
<span class="n">losses</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;xent&#39;: 0.23, &#39;l_two&#39;: 0.005}</span>
<span class="c1"># you can also compute the total loss</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span> <span class="c1"># 0.235</span>
<span class="c1"># Reset the losses</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>If you want to use <code>Losses</code> to calculate the loss of a model, you should use <code>batch_updates</code> followed by <code>total_loss</code> to get the correct batch loss. For example, a loss function could be written as:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">losses</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">batch_updates</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">batch_updates</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">losses</span>
</code></pre></div>
For convenience, the previous pattern can be simplified to a single line using the <code>loss_and_update</code> method:
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">lossses</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">loss_and_update</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">losses</span>
</code></pre></div></p>
<h4 id="lossesandmetrics">LossesAndMetrics</h4>
<p>The <code>LossesAndMetrics</code> combinator is a <code>Metric</code> that combines the <code>Lossses</code> and <code>Metrics</code> combinators. Its main utility instead of using these independently is that it can computes a single logs dictionary while making sure that names/keys remain unique in case of collisions.</p>
<div class="highlight"><pre><span></span><code><span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">jm</span><span class="o">.</span><span class="n">LossesAndMetrics</span><span class="p">(</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span>
        <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Accuracy</span><span class="p">(),</span>
        <span class="n">jm</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">F1</span><span class="p">(),</span> <span class="c1"># not yet implemented ðŸ˜…, coming soon?</span>
    <span class="p">],</span>
    <span class="n">losses</span><span class="o">=</span><span class="p">[</span>
        <span class="n">jm</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">Crossentropy</span><span class="p">(),</span>
        <span class="n">jm</span><span class="o">.</span><span class="n">regularizers</span><span class="o">.</span><span class="n">L2</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c1"># same API</span>
<span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="c1"># same API</span>
<span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span>
<span class="p">)</span>
<span class="c1"># compute new returns a dict</span>
<span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span> <span class="c1"># {&#39;loss&#39;: 0.235, &#39;accuracy&#39;: 0.95, &#39;f1&#39;: 0.87, &#39;crossentropy&#39;: 0.23, &#39;l2&#39;: 0.005}</span>
<span class="c1"># same as compute_logs in the case</span>
<span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">compute_logs</span><span class="p">()</span> <span class="c1"># {&#39;loss&#39;: 0.235, &#39;accuracy&#39;: 0.95, &#39;f1&#39;: 0.87, &#39;crossentropy&#39;: 0.23, &#39;l2&#39;: 0.005}</span>
<span class="c1"># you can also compute the total loss</span>
<span class="n">loss</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span> <span class="c1"># 0.235</span>
<span class="c1"># Reset metrics </span>
<span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div>
<p>Thanks to consistent naming, <code>Accuracy</code>, <code>F1</code> and <code>Crossentropy</code> all consume the same <code>target</code> and <code>preds</code> arguments, while <code>L2</code> consumes <code>parameters</code>. For convenience a <code>"loss"</code> key is added to the returned logs dictionary.</p>
<p>If you want to use <code>LossesAndMetrics</code> to calculate the loss of a model, you should use <code>batch_updates</code> followed by <code>total_loss</code> to get the correct batch loss. For example, a loss function could be written as:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">batch_updates</span><span class="p">(</span>
        <span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span>
    <span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">batch_updates</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span>
    <span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">losses_and_metrics</span>
</code></pre></div>
<p>For convenience, the previous pattern can be simplified to a single line using the <code>loss_and_update</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">loss_and_update</span><span class="p">(</span>
        <span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span>
    <span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">losses_and_metrics</span>
</code></pre></div>
<p>If the loss function is running in a distributed context (e.g. <code>pmap</code>) you can calculate the device-local loss and synchronize the metric state across devices like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">batch_updates</span><span class="p">(</span>
        <span class="n">target</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">preds</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span>
    <span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">batch_updates</span><span class="o">.</span><span class="n">total_loss</span><span class="p">()</span>
    <span class="n">batch_updates</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">all_gather</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">,</span> <span class="s2">&quot;device&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">()</span>
    <span class="n">losses_and_metrics</span> <span class="o">=</span> <span class="n">losses_and_metrics</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">batch_updates</span><span class="p">)</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">losses_and_metrics</span>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="api/Loss/" class="md-footer__link md-footer__link--next" aria-label="Next: Loss" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Loss
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/cgarciae" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/cgarciae88" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/in/cgarciae" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.8aa65030.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>